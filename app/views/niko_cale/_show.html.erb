<%
# Niko-cale plugin for Redmine
# Copyright (C) 2010  Yuki Kita
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
%>

<div id="niko_niko_calender">
<table border="1">
  <tr>
   <th bgcolor=<%= light_blue %>><p align="center"><font color=black><%= l(:label_member) %><br>(<%= l(:label_niko_cale_issues_count) %>)</font><br></td>
   <% @dates.each do |date| %>
     <th bgcolor=<%= light_blue %>><p align="center"><%= format_date_with_color(date) %></td>
   <% end %>
  </tr>
  <% @users.each do |user| %>
  <tr> 
    <td bgcolor=<%=light_yellow%>><p align="center"><%= link_to_feeling_list(:user=>user, :title=>user.name) %><br><font color=black>(<%= @issues_count_per_user[user] %>)</font><br></td> 
    <% @dates.each do |date| %>
      <% feeling = @feelings_per_user[user].find {|feeling| feeling.at == date} %>
      <td bgcolor=<%= ((User.current == user) && (date == Date.today)) ? pink : "" %>>
	<p align="center">
	  <% if feeling.nil? && (User.current == user) && editable?(date) %>
	    <%= link_to "Add", {:controller=>:feelings, :action=>:edit, :date=>date, :project_id=>@project.id} %>
	  <% else %>
            <%= link_to_feeling(feeling) %>
	  <% end %>
      </td>
      <% end %>
  </tr> 
  <% end %>
  <% unless @morales.empty? %>
  <tr>
    <td bgcolor=<%=gray%>><p align="center"><font color=black><%= l(:label_niko_cale_morale) %><br>(<%= @issues_count_per_user[:morale] %>)</font><br></td> 
    <% @dates.each do |date| %>
      <% morale = @morales.find {|m| m.at == date} %>
      <td bgcolor=<%=gray%>><p align="center"><%= image_for(morale) %></td>
    <% end %>
  </tr>
  <% end %>
</table>
</div>
