<%
# Niko-cale plugin for Redmine
# Copyright (C) 2010  Yuki Kita
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
%>

<%= render :partial=>'header' %>

<h3><%= l(:label_niko_cale_how_do_you_feel) %> (<%= h(format_date(@feeling.at)) %>)</h3>
<% url, option = @feeling.new_record? ?
   [{:action=>:create}, {:id=>:update_feeling, :method=>:post}] : [{:action=>:update}, {:id=>:update_feeling, :method=>:put}] %> 
<% form_tag(url, option) do %>
   <% if @project %>
     <%= hidden_field_tag 'project_id', @project.id %>
   <% end %>    
   <%= hidden_field_tag 'date', @feeling.at %>
   <table border="0">
     <tr>
       <td><%= good_image(l(:label_niko_cale_good), "document.forms.update_feeling.level[0].click()", "cursor: pointer;") %></td>
       <td><%= ordinary_image(l(:label_niko_cale_ordinary), "document.forms.update_feeling.level[1].click()", "cursor: pointer;") %></td>
       <td><%= bad_image(l(:label_niko_cale_bad), "document.forms.update_feeling.level[2].click()", "cursor: pointer;") %></td>
     </tr>
     <tr>
       <td><%= radio_button_tag("level", 2, @feeling.level ? @feeling.good? : true, {:onclick=>"document.forms.update_feeling.description.focus()"}) %></td>
       <td><%= radio_button_tag("level", 1, @feeling.ordinary?, {:onclick=>"document.forms.update_feeling.description.focus()"})  %></td>
       <td><%= radio_button_tag("level", 0, @feeling.bad?, {:onclick=>"document.forms.update_feeling.description.focus()"}) %></td>
     </tr>
  </table>
  <p><%= l(:label_optional_description) %><br>
  <p><%= text_area_tag :description, (@feeling.description || ""),  :cols=>48, :rows=>3 %></p>
  <%= submit_tag l(:button_save), :class => 'button-small', :name => nil %>
  <%= link_to_remote l(:label_preview), 
                   { :url => {:controller => :feelings, :action => :create, :id=>@feeling.id},
                     :method => :post,
                     :update => :preview,
                     :with => "Form.serialize('update_feeling')"
                   } %>

<% end %>
<div id="preview"></div>
